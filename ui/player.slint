import { NowPlaying, Song } from "model.slint";
import { HorizontalBox, VerticalBox, Slider, Button } from "std-widgets.slint";

export global MusicService {
    callback load_song(Song);
    callback play();
    callback pause();
}

export component Player {
    in-out property <NowPlaying> now-playing;
    in property <bool> autoplay;

    init => {
        debug("loading song");
        MusicService.load_song(now-playing.song);
        debug("loaded song");
        if autoplay {
            debug("autoplay");
            MusicService.play();
        } else {
            debug("no autoplay");
            MusicService.pause();
        }
    }

    HorizontalBox {
        Image {
            source: now-playing.song.cover-art;
        }

        VerticalBox {
            Text {
                text: now-playing.song.title;
            }

            Text {
                text: now-playing.song.artist;
            }

            Slider {
                minimum: 0;
                maximum: now-playing.duration;
                value: now-playing.progress * now-playing.duration;
            }

            Button {
                text: "Play";
                clicked => {
                    debug("play");
                    MusicService.load_song(now-playing.song);
                    MusicService.play();
                }
            }

            Button {
                text: "Pause";
                clicked => {
                    debug("pause");
                    MusicService.pause();
                }
            }
        }
    }
}
